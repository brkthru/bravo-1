# Comprehensive Field Calculations Documentation

This document outlines which fields are provided as input versus calculated by the system for all entity types in the Bravo-1 system. Each table includes a "Feedback" column for review and corrections.

## Legend

- **Input**: Field provided from PostgreSQL extract or API
- **Calculated**: Field computed during insert/update and stored
- **Dynamic**: Field computed at query time, not stored
- **System**: Field generated by system (IDs, timestamps)

\*\* RR Notes

---

**RR NOTES **

- Some other schema to consider for the future
  - consider a user type - which is a user of the system.
    - Can contain attributes and preferences. for example
      - we can tag people with their job family (i.e. account manager, etc)
      - who their manager is (another user record)
      - you could imagine having person specific prompts for how they like to see personalized descriptions or summaries (for instance if summarizing their campaign, or their portfolio - what is most important to them, etc)
      - We could store information like OOO date intervals, backup person information, etc
      - This would be tied to a person ID in zoho and other data from zoho
      -
- The versioning info is not listed here
- Since there are a lot of durations, should there be some kind of duration schema that contains input and calculated/dynamic fields. Such as start date, end date, duration (calculated), days elapsed, days remaining, percent complete, percent remaining, etc.
- Might there also be some schema that represents a budget (which can be a media budget, a price budget) but there are several places where we have a target amount (which might be the number of units we are expected/obligated to deliver, or the amount of money we can spend on media, or the price of a contract and how much of that contract price we have delivered). If we had a standard way to represent this concept - we could re-use that in lots of ways. There could also be calculated fields for things like amount remaining, percentage complete, and even based on the pacing plan, what their pacing is for this - so for a media budget there might be a target amount (which would be amount budgeted), we would also want to indicate what the unit type is (dollars or units), then be able to track the target amount, the duration of the budget, how much is spent/delivered, what % is complete/spent/delivered, a pacing number that compares the expect value based on pacing plan to the current value, etc.
- Note that brkthru does keep a standard "rate card" that indicates what the approved/recommended pricing is (unit price & target margin) for various channels/tactics/price types - see media tool today to see how this is actually implemented
-

## 1. Campaign Fields

| Field                                   | Type       | Source     | Description                                | Feedback                                                                                                                                                                                                                                                                                                                                                                                  |
| --------------------------------------- | ---------- | ---------- | ------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `_id`                                   | ObjectId   | System     | MongoDB document ID                        |                                                                                                                                                                                                                                                                                                                                                                                           |
| `campaignNumber`                        | string     | Input      | Unique identifier (e.g., "STR-D1F227C0")   |                                                                                                                                                                                                                                                                                                                                                                                           |
| `name`                                  | string     | Input      | Campaign name                              |                                                                                                                                                                                                                                                                                                                                                                                           |
| `accountId`                             | ObjectId   | Input      | Associated account reference               |                                                                                                                                                                                                                                                                                                                                                                                           |
| `accountName`                           | string     | Input      | Associated account name                    |                                                                                                                                                                                                                                                                                                                                                                                           |
| `status`                                | string     | Input      | Campaign status (L1, active, paused)       | Note that this is not input by the user or updated by anyone using bravo.. It is SOURCED from Zoho.. I.e. this is a field where zoho is the source of truth and bravo is keeping a copy of it.. I wonder if for the sake of clarity if we could add some designation for whether this is sourced (i.e. cached) from another source or if this is a field that bravo users update directly |
| `team.leadAccountManager.id`            | string     | Input      | Lead AM user ID                            |                                                                                                                                                                                                                                                                                                                                                                                           |
| `team.leadAccountManager.name`          | string     | Input      | Lead AM name                               |                                                                                                                                                                                                                                                                                                                                                                                           |
| `team.leadAccountManager.email`         | string     | Input      | Lead AM email                              |                                                                                                                                                                                                                                                                                                                                                                                           |
| `team.mediaTrader`                      | object     | Input      | Media trader details (optional)            | should there be a team member schema that contains the fields above, like id, name and email? like you have with lead account manager                                                                                                                                                                                                                                                     |
| `dates.start`                           | Date       | Input      | Campaign start date                        |                                                                                                                                                                                                                                                                                                                                                                                           |
| `dates.end`                             | Date       | Input      | Campaign end date                          |                                                                                                                                                                                                                                                                                                                                                                                           |
| `dates.totalDuration`                   | number     | Calculated | `end - start` in days                      |                                                                                                                                                                                                                                                                                                                                                                                           |
| `dates.daysElapsed`                     | number     | Dynamic    | Days since start (based on current date)   |                                                                                                                                                                                                                                                                                                                                                                                           |
| `dates.daysRemaining`                   | number     | Dynamic    | Days until end (based on current date)     |                                                                                                                                                                                                                                                                                                                                                                                           |
| `budget.total`                          | Decimal128 | Input      | Total campaign budget                      | this should be called price not budget.. budget should refer to media budget (i.e. internal spend budget), price refers to Brkthru retial price that clients pay                                                                                                                                                                                                                          |
| `budget.allocated`                      | Decimal128 | Input      | Budget allocated to line items             |                                                                                                                                                                                                                                                                                                                                                                                           |
| `budget.spent`                          | Decimal128 | Input      | Amount spent (from platform metrics)       |                                                                                                                                                                                                                                                                                                                                                                                           |
| `budget.remaining`                      | Decimal128 | Calculated | `total - spent`                            |                                                                                                                                                                                                                                                                                                                                                                                           |
| `budget.currency`                       | string     | Input      | Currency code (default: USD)               |                                                                                                                                                                                                                                                                                                                                                                                           |
| `metrics.impressions`                   | number     | Dynamic    | Sum from platform metrics                  | this should be units not impressions - since impressions are only one of the types of delivery                                                                                                                                                                                                                                                                                            |
| `metrics.clicks`                        | number     | Dynamic    | Sum from platform metrics                  |                                                                                                                                                                                                                                                                                                                                                                                           |
| `metrics.conversions`                   | number     | Dynamic    | Sum from platform metrics                  |                                                                                                                                                                                                                                                                                                                                                                                           |
| `metrics.deliveryPacing`                | number     | Dynamic    | `(impressions delivered / expected) * 100` |                                                                                                                                                                                                                                                                                                                                                                                           |
| `metrics.spendPacing`                   | number     | Dynamic    | `(spent / (total * elapsed %)) * 100`      |                                                                                                                                                                                                                                                                                                                                                                                           |
| `metrics.ctr`                           | number     | Dynamic    | `(clicks / impressions) * 100`             | we dont currently need this lets leave that for future                                                                                                                                                                                                                                                                                                                                    |
| `metrics.cvr`                           | number     | Dynamic    | `(conversions / clicks) * 100`             | we dont currently need this lets leave that for future                                                                                                                                                                                                                                                                                                                                    |
| `metrics.cpc`                           | Decimal128 | Dynamic    | `spent / clicks`                           |                                                                                                                                                                                                                                                                                                                                                                                           |
| `metrics.cpm`                           | Decimal128 | Dynamic    | `(spent / impressions) * 1000`             |                                                                                                                                                                                                                                                                                                                                                                                           |
| `metrics.margin`                        | number     | Dynamic    | Calculated from revenue vs cost            | can split this into margin percent and margin amount                                                                                                                                                                                                                                                                                                                                      |
| `mediaActivity`                         | string     | Dynamic    | Summary of active line items               | ?? what would this string hold ??                                                                                                                                                                                                                                                                                                                                                         |
| `lineItemCount`                         | number     | Dynamic    | Count of associated line items             |                                                                                                                                                                                                                                                                                                                                                                                           |
| `calculatedFields.allocationPercentage` | object     | Calculated | `(allocated / total) * 100` with metadata  | does this object have a schema?                                                                                                                                                                                                                                                                                                                                                           |
| `calculatedFields.spendPercentage`      | object     | Calculated | `(spent / total) * 100` with metadata      | does this object have a schema?                                                                                                                                                                                                                                                                                                                                                           |
| `createdAt`                             | Date       | System     | Record creation timestamp                  |                                                                                                                                                                                                                                                                                                                                                                                           |
| `updatedAt`                             | Date       | System     | Last update timestamp                      |                                                                                                                                                                                                                                                                                                                                                                                           |

**RR NOTE**S

- under metrics there are portentially other types of metrics that can be pulled - such as the video advertising metrics and others
- Team members:
  - For team members, there should be
    - 0..1 CSD (sales person)
    - 0..1 Account Manager
    - 0..1 senior media traders
    - 0..many media traders <- but you have these (correctly) assigned at the line item level.. however someone may want to look up campaigns by the media trader(s) working on them
  - see note above about having a user schema

---

## 2. Media Strategy Fields

| Field         | Type       | Source     | Description                                | Feedback                                                                                                                                                                                                                           |
| ------------- | ---------- | ---------- | ------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `_id`         | ObjectId   | System     | MongoDB document ID                        |                                                                                                                                                                                                                                    |
| `campaignId`  | ObjectId   | Input      | Parent campaign reference                  |                                                                                                                                                                                                                                    |
| `name`        | string     | Input      | Strategy name (often null)                 |                                                                                                                                                                                                                                    |
| `status`      | string     | Input      | Strategy status                            | Interesting.. Should this be an enum value? What would the status values be? Im assuming this is different than the status above                                                                                                   |
| `isActive`    | boolean    | Input      | Active flag                                | I think this one would be either calculated or dynamic. Need to determine what active means - can you get any clues from the media-tool codebase? It could mean "actively buying now", or it could mean "has purchased some media" |
| `changesetId` | number     | Input      | Version tracking ID                        |                                                                                                                                                                                                                                    |
| `lineItems`   | array      | Dynamic    | Associated line items (populated on query) |                                                                                                                                                                                                                                    |
| `totalBudget` | Decimal128 | Calculated | Sum of line item budgets                   |                                                                                                                                                                                                                                    |
| `totalSpend`  | Decimal128 | Dynamic    | Sum of line item spend                     |                                                                                                                                                                                                                                    |
| `createdAt`   | Date       | System     | Record creation timestamp                  |                                                                                                                                                                                                                                    |
| `updatedAt`   | Date       | System     | Last update timestamp                      |                                                                                                                                                                                                                                    |

** RR NOTE ** shouldnt media strategy be part of campaigns and not a separate object?

---

## 3. Line Item Fields

| Field                     | Type       | Source     | Description                          | Feedback                                                                               |
| ------------------------- | ---------- | ---------- | ------------------------------------ | -------------------------------------------------------------------------------------- |
| `_id`                     | ObjectId   | System     | MongoDB document ID                  |                                                                                        |
| `strategyId`              | ObjectId   | Input      | Parent strategy reference            |                                                                                        |
| `campaignId`              | ObjectId   | Input      | Parent campaign reference            |                                                                                        |
| `name`                    | string     | Input      | Line item name                       |                                                                                        |
| `description`             | string     | Input      | Line item description                |                                                                                        |
| `audience`                | string     | Input      | Target audience description          |                                                                                        |
| `geo`                     | string     | Input      | Geographic targeting                 |                                                                                        |
| `targeting`               | string     | Input      | Additional targeting criteria        |                                                                                        |
| `adFormats`               | string     | Input      | Ad format types                      |                                                                                        |
| `startDate`               | Date       | Input      | Line item start date                 | should this be like dates.start like in campaigns?                                     |
| `endDate`                 | Date       | Input      | Line item end date                   |                                                                                        |
| `duration`                | number     | Calculated | `endDate - startDate` in days        |                                                                                        |
| `price`                   | Decimal128 | Input      | Total line item price/budget         |                                                                                        |
| `unitPrice`               | Decimal128 | Input      | Price per unit                       |                                                                                        |
| `mediaBudget`             | Decimal128 | Input      | Media budget allocation              |                                                                                        |
| `targetUnitCost`          | Decimal128 | Input      | Target cost per unit                 |                                                                                        |
| `targetMargin`            | number     | Input      | Target margin percentage             |                                                                                        |
| `actualUnitCost`          | Decimal128 | Calculated | `totalSpend / deliveredUnits`        |                                                                                        |
| `marginAmount`            | Decimal128 | Calculated | `revenue - cost`                     |                                                                                        |
| `marginPercentage`        | number     | Calculated | `((revenue - cost) / revenue) * 100` |                                                                                        |
| `profitAmount`            | Decimal128 | Calculated | `revenue - cost`                     | should standardize name here. profitAmount vs MarginAmount.. Im good with marginAmount |
| `pacingType`              | string     | Input      | Pacing type (even, custom, etc.)     | should this be an enum?                                                                |
| `pacingDetails`           | object     | Input      | Budget blocks for custom pacing      |                                                                                        |
| `mediaTraderUserIds`      | array      | Input      | Assigned media trader IDs            |                                                                                        |
| `mediaPlatformIds`        | array      | Input      | Target platform IDs                  |                                                                                        |
| `channelId`               | number     | Input      | Channel reference                    |                                                                                        |
| `channelName`             | string     | Dynamic    | Channel name from lookup             |                                                                                        |
| `tacticId`                | number     | Input      | Tactic reference                     |                                                                                        |
| `tacticName`              | string     | Dynamic    | Tactic name from lookup              |                                                                                        |
| `unitPriceTypeId`         | number     | Input      | Unit type reference                  |                                                                                        |
| `unitType`                | string     | Calculated | Mapped from unitPriceTypeId          |                                                                                        |
| `plannedUnits`            | number     | Input      | Number of units planned              |                                                                                        |
| `deliveredUnits`          | number     | Dynamic    | Sum from platform metrics            |                                                                                        |
| `purchaseOrderNumber`     | string     | Input      | PO number reference                  |                                                                                        |
| `pacing.spend`            | number     | Dynamic    | Spend pacing percentage              |                                                                                        |
| `pacing.delivery`         | number     | Dynamic    | Delivery pacing percentage           |                                                                                        |
| `performance.impressions` | number     | Dynamic    | Total impressions delivered          | change to clicks                                                                       |
| `performance.clicks`      | number     | Dynamic    | Total clicks                         |                                                                                        |
| `performance.conversions` | number     | Dynamic    | Total conversions                    | dont need this yet                                                                     |
| `performance.cpm`         | Decimal128 | Dynamic    | Cost per thousand impressions        |                                                                                        |
| `performance.cpc`         | Decimal128 | Dynamic    | Cost per click                       |                                                                                        |
| `performance.cpa`         | Decimal128 | Dynamic    | Cost per acquisition                 |                                                                                        |
| `changesetId`             | number     | Input      | Version tracking ID                  |                                                                                        |
| `isActive`                | boolean    | Input      | Active flag                          |                                                                                        |
| `createdAt`               | Date       | System     | Record creation timestamp            |                                                                                        |
| `updatedAt`               | Date       | System     | Last update timestamp                |                                                                                        |

---

## 4. Platform Buy (Media Buy) Fields

**RR NOTE**

- Going forward these shouild be referred to as Platform buys, they are independant of Campaigns/Media strategies - but are connected to them through Media Plans

| Field                             | Type       | Source     | Description                   | Feedback                                                                                                                                                                                               |
| --------------------------------- | ---------- | ---------- | ----------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `_id`                             | ObjectId   | System     | MongoDB document ID           |                                                                                                                                                                                                        |
| `mediaPlatformId`                 | number     | Input      | Platform reference            |                                                                                                                                                                                                        |
| `mediaPlatformName`               | string     | Dynamic    | Platform name from lookup     |                                                                                                                                                                                                        |
| `name`                            | string     | Input      | Platform buy name             |                                                                                                                                                                                                        |
| `startDate`                       | Date       | Input      | Buy start date                | should this follow dates.start like in campaigns                                                                                                                                                       |
| `endDate`                         | Date       | Input      | Buy end date (nullable)       |                                                                                                                                                                                                        |
| `budget`                          | Decimal128 | Input      | Buy budget                    |                                                                                                                                                                                                        |
| `spend`                           | Decimal128 | Input      | Actual spend amount           | this is sourced from the media platforms through ETL processes of extracting perfromance date. This would be calculated from the daily metrics like impressions - but it would be daily spend numbers. |
| `remainingBudget`                 | Decimal128 | Calculated | `budget - spend`              |                                                                                                                                                                                                        |
| `mediaPlatformEntityId`           | ObjectId   | Input      | Platform entity reference     |                                                                                                                                                                                                        |
| `advertiserMediaPlatformEntityId` | ObjectId   | Input      | Advertiser entity reference   |                                                                                                                                                                                                        |
| `campaignNumbers`                 | array      | Input      | Associated campaign numbers   |                                                                                                                                                                                                        |
| `deliveryMetrics.impressions`     | number     | Dynamic    | Sum from daily metrics        | this would be units not impressions, would also need a unit type though                                                                                                                                |
| `deliveryMetrics.clicks`          | number     | Dynamic    | Sum from daily metrics        |                                                                                                                                                                                                        |
| `deliveryMetrics.conversions`     | number     | Dynamic    | Sum from daily metrics        | dont need this yet                                                                                                                                                                                     |
| `deliveryMetrics.videoViews`      | number     | Dynamic    | Sum from daily video metrics  |                                                                                                                                                                                                        |
| `deliveryMetrics.videoCompletes`  | number     | Dynamic    | Sum from daily video metrics  |                                                                                                                                                                                                        |
| `spendPacing`                     | number     | Dynamic    | `(spend / budget) * 100`      |                                                                                                                                                                                                        |
| `daysSinceLastActivity`           | number     | Dynamic    | Days since last metric update |                                                                                                                                                                                                        |
| `isActive`                        | boolean    | Dynamic    | Based on recent activity      | need a clear definition of this                                                                                                                                                                        |
| `changesetId`                     | number     | Input      | Version tracking ID           |                                                                                                                                                                                                        |
| `isDeleted`                       | boolean    | Input      | Soft delete flag              |                                                                                                                                                                                                        |
| `createdAt`                       | Date       | System     | Record creation timestamp     |                                                                                                                                                                                                        |
| `updatedAt`                       | Date       | System     | Last update timestamp         |                                                                                                                                                                                                        |

---

## 5. Media Plan (Line Item Media Buy) Fields

| Field                     | Type       | Source     | Description                        | Feedback |
| ------------------------- | ---------- | ---------- | ---------------------------------- | -------- |
| `_id`                     | ObjectId   | System     | MongoDB document ID                |          |
| `lineItemId`              | ObjectId   | Input      | Parent line item reference         |          |
| `mediaBuyId`              | ObjectId   | Input      | Associated media buy (nullable)    |          |
| `name`                    | string     | Input      | Plan name (often empty)            |          |
| `targetUnitCost`          | Decimal128 | Input      | Target cost per unit for this plan |          |
| `budget`                  | Decimal128 | Input      | Budget allocation for this plan    |          |
| `actualUnitCost`          | Decimal128 | Dynamic    | Calculated from actual delivery    |          |
| `spend`                   | Decimal128 | Dynamic    | Actual spend from platform metrics |          |
| `budgetUtilization`       | number     | Calculated | `(spend / budget) * 100`           |          |
| `performance.impressions` | number     | Dynamic    | Impressions for this allocation    |          |
| `performance.clicks`      | number     | Dynamic    | Clicks for this allocation         |          |
| `performance.conversions` | number     | Dynamic    | Conversions for this allocation    |          |
| `changesetId`             | number     | Input      | Version tracking ID                |          |
| `isDeleted`               | boolean    | Input      | Soft delete flag                   |          |
| `createdAt`               | Date       | System     | Record creation timestamp          |          |
| `updatedAt`               | Date       | System     | Last update timestamp              |          |

---

## 6. Platform Buy Daily Impressions

** RR NOTE **

- Whats the point of having a separate daily impressions versus daily videos?? Note there are other types of units like clicks for search engine marketing Do we need to include those? \*

| Field           | Type       | Source     | Description                    | Feedback                                                          |
| --------------- | ---------- | ---------- | ------------------------------ | ----------------------------------------------------------------- |
| `platformId`    | number     | Input      | Platform identifier            |                                                                   |
| `platformBuyId` | string     | Input      | Platform buy identifier        |                                                                   |
| `onDate`        | Date       | Input      | Date of metrics                |                                                                   |
| `impressions`   | number     | Input      | Daily impressions count        |                                                                   |
| `clicks`        | number     | Input      | Daily clicks count             |                                                                   |
| `conversions`   | number     | Input      | Daily conversions count        |                                                                   |
| `cost`          | Decimal128 | Input      | Daily cost amount              | change the name to cost                                           |
| `totalSpend`    | Decimal128 | Input      | Daily total spend              | remove this.. if this is cumulative spend you could document that |
| `bids`          | number     | Input      | Daily bid count (nullable)     |                                                                   |
| `cpm`           | Decimal128 | Calculated | `(cost / impressions) * 1000`  |                                                                   |
| `cpc`           | Decimal128 | Calculated | `cost / clicks`                |                                                                   |
| `cpa`           | Decimal128 | Calculated | `cost / conversions`           | dont need yet                                                     |
| `ctr`           | number     | Calculated | `(clicks / impressions) * 100` |                                                                   |
| `cvr`           | number     | Calculated | `(conversions / clicks) * 100` |                                                                   |
| `updatedAt`     | Date       | System     | Last update timestamp          |                                                                   |

---

## 7. Platform Buy Daily Videos

| Field             | Type   | Source     | Description                           | Feedback |
| ----------------- | ------ | ---------- | ------------------------------------- | -------- |
| `platformId`      | number | Input      | Platform identifier                   |          |
| `platformBuyId`   | string | Input      | Platform buy identifier               |          |
| `onDate`          | Date   | Input      | Date of metrics                       |          |
| `videoViews`      | number | Input      | Total video views                     |          |
| `videoViews2s`    | number | Input      | 2-second video views                  |          |
| `videoViewsP25`   | number | Input      | 25% completion views                  |          |
| `videoViewsP50`   | number | Input      | 50% completion views                  |          |
| `videoViewsP75`   | number | Input      | 75% completion views                  |          |
| `videoCompletes`  | number | Input      | Full video completions                |          |
| `completionRate`  | number | Calculated | `(videoCompletes / videoViews) * 100` |          |
| `viewThroughRate` | number | Calculated | Various calculations per platform     |          |
| `updatedAt`       | Date   | System     | Last update timestamp                 |          |

---

## Calculation Engine Metadata

All calculated fields include the following metadata structure:

** RR Question **

- I like this.. does this mean that the value comes back as an object for all of those?
- will value always be this type even for integer typed values (i.e. units remaining)?
- will dynamically calculated values have this same structure?
- should we call out whether this values is stored or dynamically returned - is that even meaningful for a user to know?

```javascript
{
  value: Decimal128,              // The calculated value
  calculationVersion: string,     // Version of calculation engine (e.g., "1.0.0")
  calculatedAt: Date,            // When calculation was performed
  context: string,               // Context (e.g., "etl_import", "api_update")
  formula: string,               // Formula reference
  precision: number,             // Decimal places used
  roundingMode: string           // Rounding mode applied
}
```

## Key Relationships

1. **Campaign → Strategy**: 1:1 relationship
2. **Strategy → Line Items**: 1:many relationship
3. **Line Items → Media Plans**: 1:many relationship
4. **Media Plans → Platform Buys**: many:1 optional relationship
5. **Platform Buys → Daily Metrics**: 1:many relationship

## Rounding Policies

- **Storage**: 6 decimal places (microdollar precision)
- **Display**: 2 decimal places (standard currency)
- **Percentages**: 2 decimal places
- **Unit Costs**: 4 decimal places
- **Special Cases**:
  - YouTube CPV: 3 decimal places
  - CPM calculations: 2 decimal places

## Notes

1. **Dynamic fields** are calculated at query time using aggregation pipelines or application logic
2. **Calculated fields** are computed during insert/update and stored with full audit metadata
3. **Platform metrics** are ingested from external systems and used as input for calculations
4. **Version tracking** via changesetId allows for historical analysis and rollback capabilities
